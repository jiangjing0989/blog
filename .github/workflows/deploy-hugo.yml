name: Deploy Hugo Site from Obsidian Notes

# å½“ Obsidian ä»“åº“æœ‰æ–° push æ—¶è§¦å‘æ­¤å·¥ä½œæµ
on:
  repository_dispatch:
    types: [note-updated]
  # push:
    # è¿™é‡Œå®šä¹‰äº†ç›‘å¬çš„ä»“åº“å’Œåˆ†æ”¯
    # æ³¨æ„ï¼šéœ€è¦é…ç½®ä»“åº“è·¯å¾„
    # branches:
      # - main  # æ›¿æ¢æˆä½ çš„ Obsidian ä»“åº“ä¸»åˆ†æ”¯å
    # paths:
      # - '**'  # ç›‘å¬æ‰€æœ‰æ–‡ä»¶å˜åŒ–

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      # æ­¥éª¤ 1: æ£€å‡º Hugo ä»“åº“ä»£ç 
      - name: Checkout Hugo Repo
        uses: actions/checkout@v4
        with:
          submodules: true
          fetch-depth: 0

      # æ­¥éª¤ 2: æ£€å‡º Obsidian ä»“åº“ç¬”è®°åˆ° content ç›®å½•
      - name: Checkout Obsidian Notes
        uses: actions/checkout@v4
        with:
          repository: jiangjing0989/note # æ›¿æ¢æˆä½ çš„ Obsidian ä»“åº“å
          token: ${{ secrets.PAT_FOR_OBSIDIAN }}
          path: content  # å°†ç¬”è®°å…‹éš†åˆ° Hugo ä»“åº“çš„ content ç›®å½•
          ref: main # æ›¿æ¢æˆä½ çš„ Obsidian ä»“åº“ä¸»åˆ†æ”¯å

      # æ­¥éª¤ 3: è®¾ç½® Hugo ç¯å¢ƒ
      - name: Setup Hugo
        uses: peaceiris/actions-hugo@v2
        with:
          hugo-version: 'latest'
          extended: true

      # æ­¥éª¤ 4: æ„å»º Hugo é™æ€ç«™ç‚¹
      - name: Build Hugo Site
        run: hugo --minify

      # æ­¥éª¤ 5: å°†ç”Ÿæˆçš„ç«™ç‚¹å‘å¸ƒåˆ° GitHub Pages
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.PAT_FOR_OBSIDIAN }}
          publish_dir: ./public
          cname: www.jiangjingspace.com   # ğŸ‘ˆ è‡ªåŠ¨ç”Ÿæˆ CNAME æ–‡ä»¶
          # å¦‚æœä½ çš„ GitHub Pages åˆ†æ”¯ä¸æ˜¯ gh-pagesï¼Œéœ€è¦åœ¨è¿™é‡ŒæŒ‡å®š
          # publish_branch: main